<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸ä½è¯çµ¡ç°¿ç·¨è¼¯å™¨</title>
    <!-- Tailwind CSS for UI controls -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@400;700&display=swap');

        /* å­—å—¨æ³¨éŸ³ WebFont è¨­å®š */
        @font-face {
            font-family: "ZiHiBpmf";
            src: url("https://gear.tsps.tp.edu.tw/fonts/BpmfZihiKaiStd-Regular.woff2") format("woff2");
            font-display: swap;
        }

        /* å®šç¾©è®Šæ•¸ (é è¨­æ·ºè‰²ä¸»é¡Œ) */
        :root {
            /* é¡è‰²è®Šæ•¸ */
            --body-bg: #e5e7eb;
            --control-bg: #ffffff;
            --control-text: #1f2937;
            --paper-bg: #fdfbf7;
            --line-color: #2e8b57; /* æµ·ç¶ è‰² */
            --text-color: #000080; /* æ·±è—è‰² */
            --date-box-bg: rgba(255, 255, 255, 0.5);
            --date-label-color: #444444;
            --date-val-color: #000000;
            --date-border-color: #888888;
            --shadow-color: rgba(0, 0, 0, 0.1);

            /* è¨­å®šè®Šæ•¸ */
            --font-size: 40px;
            --line-height-ratio: 1.8;
            --current-font: "DFKai-SB", "BiauKai", "æ ‡æ¥·ä½“", "KaiTi", "Noto Serif TC", serif;
        }

        /* æ·±è‰²ä¸»é¡Œè®Šæ•¸è¦†å¯« */
        [data-theme="dark"] {
            --body-bg: #111827;
            --control-bg: #1f2937;
            --control-text: #f3f4f6;
            --paper-bg: #2d3748; /* æ·±ç°è—ç´™å¼µ */
            --line-color: #68d391; /* äº®ç¶ è‰²æ ¼ç·š */
            --text-color: #e2e8f0; /* æ·ºç°ç™½æ–‡å­— */
            --date-box-bg: rgba(0, 0, 0, 0.3);
            --date-label-color: #a0aec0;
            --date-val-color: #ffffff;
            --date-border-color: #cbd5e0;
            --shadow-color: rgba(0, 0, 0, 0.5);
        }

        body {
            background-color: var(--body-bg);
            color: var(--control-text);
            font-family: "Noto Sans TC", sans-serif;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        #controls {
            background: var(--control-bg);
            color: var(--control-text);
            padding: 0.5rem 1rem;
            box-shadow: 0 -2px 4px var(--shadow-color);
            z-index: 50;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s, color 0.3s;
        }

        /* é‡å° Tailwind çš„ select å’Œ input åšæ·±è‰²æ¨¡å¼é©é… */
        [data-theme="dark"] #controls select,
        [data-theme="dark"] #controls input[type="text"] {
            background-color: #374151;
            color: white;
            border-color: #4b5563;
        }
        
        [data-theme="dark"] #controls label {
            color: #d1d5db;
        }

        #workspace {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
        }

        /* ç´™å¼µå®¹å™¨ */
        .paper {
            background-color: var(--paper-bg);
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            box-shadow: 0 4px 6px -1px var(--shadow-color);
            border: 1px solid var(--date-border-color); /* ä½¿ç”¨é€šç”¨é‚Šæ¡†è‰² */
            position: relative;
            box-sizing: border-box;
            display: flex;
            flex-direction: row-reverse; /* æ—¥æœŸåœ¨å³(èµ·é») */
            padding: 2rem;
            overflow: hidden;
            transition: background-color 0.3s;
        }

        /* æ—¥æœŸæ¬„ä½ */
        .date-column {
            width: 80px;
            height: 100%;
            font-family: "DFKai-SB", "BiauKai", serif;
            font-size: 24px;
            color: var(--date-label-color);
            border-left: 3px double var(--line-color);
            padding-left: 10px;
            margin-left: 10px;
            display: flex;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ä¸»è¦ç·¨è¼¯å€å¡Šå®¹å™¨ */
        .main-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        /* è¡Œè™Ÿå°ºæ¨™åˆ— */
        .line-ruler {
            height: 30px;
            display: flex;
            flex-direction: row-reverse;
            border-bottom: 1px solid var(--line-color);
            margin-bottom: 5px;
            color: var(--line-color);
            font-size: 16px;
            font-family: "Noto Sans TC", sans-serif;
            overflow: hidden;
            flex-shrink: 0;
        }

        .ruler-num {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            user-select: none;
        }

        /* å¯¦éš›æ–‡å­—è¼¸å…¥å€ */
        #content-area {
            font-family: var(--current-font);
            font-size: var(--font-size);
            line-height: var(--line-height-ratio);
            color: var(--text-color);
            
            flex: 1;
            height: 100%;
            
            /* ç›´æ›¸è¨­å®š */
            writing-mode: vertical-rl;
            text-orientation: upright;
            
            outline: none;
            white-space: pre-wrap;
            overflow: hidden;
            
            /* è®“æ–‡å­—å‚ç›´ç½®ä¸­æ–¼è¡Œé«˜å…§ */
            padding-top: calc(var(--font-size) * 0.2);
            padding-left: 0;
            padding-right: 0;

            /* æ ¼ç·šèƒŒæ™¯ */
            background-image: repeating-linear-gradient(
                to left,
                var(--line-color) 0,
                var(--line-color) 1px,
                transparent 1px,
                transparent calc(var(--font-size) * var(--line-height-ratio))
            );
            background-attachment: local;
            background-position: right top;
            transition: color 0.3s; /* æ–‡å­—é¡è‰²éæ¸¡ */
        }

        #content-area div, #content-area p {
            margin: 0;
            padding: 0;
        }

        /* æ—¥æœŸå…§éƒ¨å…ƒä»¶æ¨£å¼ */
        .date-box {
            border: 2px solid var(--line-color);
            border-radius: 8px;
            padding: 10px 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: var(--date-box-bg);
            height: auto;
        }
        .date-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .date-val {
            font-weight: bold;
            font-size: 32px;
            color: var(--date-val-color);
            border-bottom: 1px solid var(--date-border-color);
            text-align: center;
            min-width: 1.5em;
        }
        .num-mode {
            writing-mode: horizontal-tb;
            line-height: 1.2;
        }
        .text-mode {
            writing-mode: vertical-rl;
            text-orientation: upright;
        }

        /* å…±ç”¨ Modal æ¨£å¼ */
        .modal-overlay-style {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            justify-content: center; align-items: center;
        }
        
        /* å„²å­˜ç‹€æ…‹æç¤º */
        #save-status {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        #save-status.show {
            opacity: 1;
        }

        @media print {
            #controls { display: none; }
            #save-status { display: none; } /* åˆ—å°æ™‚éš±è—å„²å­˜æç¤º */
            body { background: white; height: auto; display: block; color: black; }
            #workspace { display: block; padding: 0; }
            .paper { 
                box-shadow: none; border: none; height: 100vh; max-width: none; padding: 0; 
                background-color: white !important; /* å¼·åˆ¶ç™½åº• */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            #content-area { 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
                color: #000080 !important; /* å¼·åˆ¶åˆ—å°ç‚ºæ·±è—è‰² */
            }
            /* åˆ—å°æ™‚å¼·åˆ¶é‚„åŸæ ¼ç·šé¡è‰² */
            :root {
                --line-color: #2e8b57 !important;
            }
            .line-ruler { border-bottom: 1px solid #ccc; color: #888; }
        }
    </style>
</head>
<body>

    <div id="save-status">å·²å„²å­˜</div>

    <div id="workspace">
        <div class="paper">
            <!-- å³å´ï¼šæ—¥æœŸæ¬„ -->
            <div class="date-column">
                <div class="date-box">
                    <div class="date-item">
                        <span>æ°‘<br>åœ‹</span>
                        <div class="date-val num-mode" contenteditable="true" id="roc-year"></div>
                        <span>å¹´</span>
                    </div>
                    <div class="date-item">
                        <div class="date-val num-mode" contenteditable="true" id="month"></div>
                        <span>æœˆ</span>
                    </div>
                    <div class="date-item">
                        <div class="date-val num-mode" contenteditable="true" id="day"></div>
                        <span>æ—¥</span>
                    </div>
                    <div class="date-item">
                        <br>
                        <span>æ˜Ÿ<br>æœŸ</span>
                        <div class="date-val text-mode" contenteditable="true" id="weekday"></div>
                    </div>
                </div>
            </div>

            <!-- å·¦å´ï¼šä¸»è¦ç·¨è¼¯å€ -->
            <div class="main-column" id="main-column">
                <div class="line-ruler" id="line-ruler"></div>
                <div id="content-area" contenteditable="true">ä¸€ã€æº–å‚™å¥½ç¹³äº¤çš„ä½œæ¥­ã€‚<br>äºŒã€å®‰éœé–±è®€ã€‚</div>
            </div>
        </div>
    </div>

    <!-- å·¥å…·åˆ— -->
    <div id="controls" class="border-t border-gray-300">
        <!-- å·¦ä¸‹è§’ï¼šè¿”å› + ä¸»é¡Œåˆ‡æ› -->
        <div class="flex items-center gap-2">
            <a href="index.html" class="flex items-center gap-1 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white font-medium px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition no-underline">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                <span class="hidden sm:inline">è¿”å›</span>
            </a>
            
            <button onclick="toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ (æ·ºè‰²/æ·±è‰²)" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                <span id="theme-icon">ğŸŒ“</span>
            </button>
        </div>

        <!-- ä¸­é–“ï¼šä¸»è¦æ§åˆ¶é … -->
        <div class="flex flex-wrap items-center justify-center gap-4 mx-auto">
            <div class="flex items-center gap-2">
                <label for="font-size" class="font-bold">å­—é«”å¤§å°:</label>
                <input type="range" id="font-size" min="24" max="72" value="40" class="w-24 sm:w-32 accent-green-600">
                <span id="font-size-val" class="text-sm font-mono w-8">40</span>px
            </div>

            <div class="flex items-center gap-2">
                <label for="font-family" class="font-bold">å­—å‹:</label>
                <select id="font-family" class="border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-green-500 max-w-[150px]">
                    <option value="default">é è¨­æ¨™æ¥·é«”</option>
                    <option value="zihi">å­—å—¨/BpmfVS</option>
                    <option value="sans">é»‘é«”</option>
                </select>
            </div>

            <div class="flex items-center gap-2 border-l pl-2 border-gray-300 dark:border-gray-600">
                <a href="https://buttaiwan.github.io/bpmfvs/" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded shadow transition flex items-center gap-2 no-underline text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                    <span>é¸å­—å™¨</span>
                </a>
            </div>
            
            <button onclick="openConfirmModal()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded shadow transition text-sm">
                æ¸…ç©º
            </button>
        </div>

        <!-- å³ä¸‹è§’ï¼šæˆæ¬Šè³‡è¨Š -->
        <a href="fonts/FONT-LICENSE.txt" target="_blank" class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-300 text-sm underline px-2">
            æˆæ¬Šè³‡è¨Š
        </a>
    </div>

    <!-- å­—å—¨æç¤º Modal -->
    <div id="modal-overlay" class="modal-overlay-style">
        <div id="modal" style="background: white; padding: 2rem; border-radius: 0.5rem; max-width: 500px; text-align: center; color: black;">
            <h3 class="text-xl font-bold mb-4 text-green-700">å­—å—¨/BpmfVS æ³¨éŸ³æ¨¡å¼</h3>
            <p class="text-gray-700 mb-4 text-left leading-relaxed">
                æ‚¨é¸æ“‡äº†æ³¨éŸ³æ”¯æ´å­—å‹ (ZiHiBpmf)ã€‚<br><br>
                1. ç³»çµ±æ­£åœ¨è¼‰å…¥é›²ç«¯å­—å‹ã€‚<br>
                2. è‹¥éœ€è¼¸å…¥ç‰¹æ®Šç ´éŸ³å­—æˆ–ä¿®æ­£è²èª¿ï¼Œ<br>
                   è«‹ä½¿ç”¨ä¸‹æ–¹çš„ <strong>ã€Œé¸å­—å™¨ã€</strong> é€£çµã€‚<br>
            </p>
            <button onclick="closeModal()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <!-- æ¸…ç©ºç¢ºèª Modal -->
    <div id="confirm-modal-overlay" class="modal-overlay-style">
        <div style="background: white; padding: 2rem; border-radius: 0.5rem; max-width: 400px; text-align: center; color: black;">
            <h3 class="text-xl font-bold mb-4 text-red-700">ç¢ºå®šæ¸…ç©ºå…§å®¹ï¼Ÿ</h3>
            <p class="text-gray-700 mb-6">æ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼Œæ‚¨ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡å­—å—ï¼Ÿ</p>
            <div class="flex justify-center gap-4">
                <button onclick="performClear()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded shadow transition">ç¢ºå®š</button>
                <button onclick="closeConfirmModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded shadow transition">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        const root = document.documentElement;
        const fontSizeInput = document.getElementById('font-size');
        const fontSizeVal = document.getElementById('font-size-val');
        const fontFamilySelect = document.getElementById('font-family');
        const modalOverlay = document.getElementById('modal-overlay');
        const confirmModalOverlay = document.getElementById('confirm-modal-overlay');
        const contentArea = document.getElementById('content-area');
        const lineRuler = document.getElementById('line-ruler');
        const mainColumn = document.getElementById('main-column');
        const saveStatus = document.getElementById('save-status');

        const elYear = document.getElementById('roc-year');
        const elMonth = document.getElementById('month');
        const elDay = document.getElementById('day');
        const elWeekday = document.getElementById('weekday');

        const STORAGE_KEY = 'contactbook_data_v1';

        // --- ä¸»é¡Œåˆ‡æ›é‚è¼¯ ---
        function toggleTheme() {
            const currentTheme = root.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            root.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                root.setAttribute('data-theme', savedTheme);
            }
        }

        // --- è‡ªå‹•å„²å­˜èˆ‡è¼‰å…¥é‚è¼¯ ---
        function saveData() {
            const data = {
                content: contentArea.innerHTML,
                year: elYear.innerText,
                month: elMonth.innerText,
                day: elDay.innerText,
                weekday: elWeekday.innerText,
                fontSize: fontSizeInput.value,
                fontFamily: fontFamilySelect.value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            
            // é¡¯ç¤ºå·²å„²å­˜æç¤º
            saveStatus.classList.add('show');
            setTimeout(() => {
                saveStatus.classList.remove('show');
            }, 1500);
        }

        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    // æ¢å¾©å…§å®¹
                    if (data.content) contentArea.innerHTML = data.content;
                    if (data.year) elYear.innerText = data.year;
                    if (data.month) elMonth.innerText = data.month;
                    if (data.day) elDay.innerText = data.day;
                    if (data.weekday) elWeekday.innerText = data.weekday;
                    
                    // æ¢å¾©è¨­å®š
                    if (data.fontSize) {
                        fontSizeInput.value = data.fontSize;
                        fontSizeVal.innerText = data.fontSize;
                        root.style.setProperty('--font-size', data.fontSize + 'px');
                    }
                    if (data.fontFamily) {
                        fontFamilySelect.value = data.fontFamily;
                        // è§¸ç™¼ change äº‹ä»¶ä»¥æ‡‰ç”¨å­—é«”
                        const event = new Event('change');
                        fontFamilySelect.dispatchEvent(event);
                    }
                } catch (e) {
                    console.error("è¼‰å…¥è³‡æ–™å¤±æ•—:", e);
                }
            } else {
                // è‹¥ç„¡å­˜æª”ï¼Œå‰‡åˆå§‹åŒ–æ—¥æœŸ
                setDate();
            }
        }

        // --- è¡Œè™Ÿå°ºæ¨™æ›´æ–°é‚è¼¯ ---
        function updateRuler() {
            const fontSize = parseInt(fontSizeInput.value);
            // æ”¹ç‚ºå‹•æ…‹è®€å– CSS è®Šæ•¸ï¼Œç¢ºä¿æ¯”ä¾‹ä¸€è‡´
            const ratioStr = getComputedStyle(root).getPropertyValue('--line-height-ratio').trim();
            const lineHeightRatio = parseFloat(ratioStr) || 1.8;
            
            const columnWidth = fontSize * lineHeightRatio;
            const totalWidth = mainColumn.clientWidth;
            
            // è¨ˆç®—å¯å®¹ç´çš„è¡Œæ•¸
            const count = Math.ceil(totalWidth / columnWidth);
            
            let html = '';
            for (let i = 1; i <= count; i++) {
                html += `<div class="ruler-num" style="width: ${columnWidth}px">${i}</div>`;
            }
            lineRuler.innerHTML = html;
        }

        window.addEventListener('resize', updateRuler);

        function setDate() {
            const now = new Date();
            elYear.innerText = now.getFullYear() - 1911;
            elMonth.innerText = now.getMonth() + 1;
            elDay.innerText = now.getDate();
            elWeekday.innerText = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()];
        }

        // --- ç›£è½å™¨ ---
        
        // å­—é«”å¤§å°ï¼šä½¿ç”¨ requestAnimationFrame ç¢ºä¿æ»‘å‹•æ™‚æµæš¢æ›´æ–°ç‰ˆé¢
        fontSizeInput.addEventListener('input', (e) => {
            const size = e.target.value;
            fontSizeVal.innerText = size;
            
            requestAnimationFrame(() => {
                root.style.setProperty('--font-size', size + 'px');
                updateRuler(); // èª¿æ•´å¤§å°æ™‚ç«‹å³é‡æ’å°ºæ¨™
                
                // å¼·åˆ¶ç€è¦½å™¨é‡æ–°è¨ˆç®—ç‰ˆé¢ (Reflow)ï¼Œè§£æ±º vertical-rl æ¨¡å¼ä¸‹æ–‡å­—é å·¦çš„å•é¡Œ
                contentArea.style.display = 'none';
                void contentArea.offsetHeight; // è®€å–å±¬æ€§å¼·åˆ¶ reflow
                contentArea.style.display = '';
            });
            
            saveData(); 
        });

        fontFamilySelect.addEventListener('change', (e) => {
            const selected = e.target.value;
            let fontStack = '';
            // é˜²æ­¢éè¿´è§¸ç™¼ (å¦‚æœæ˜¯ loadData å‘¼å«çš„)
            if (e.isTrusted === false && selected === 'zihi') {
                 // ç¨‹å¼è§¸ç™¼çš„ï¼Œä¸é¡¯ç¤º Modal
            } else if (selected === 'zihi') {
                 showModal();
            }

            if (selected === 'zihi') {
                fontStack = '"ZiHiBpmf", "ZihiChinyinKai", "ZihiChinyin", "BpmfVS", "GenRyuMin", "DFKai-SB", "BiauKai", "KaiTi", serif';
            } else if (selected === 'sans') {
                fontStack = '"Noto Sans TC", "Microsoft JhengHei", sans-serif';
            } else {
                fontStack = '"DFKai-SB", "BiauKai", "æ ‡æ¥·ä½“", "KaiTi", "Noto Serif TC", serif';
            }
            root.style.setProperty('--current-font', fontStack);
            saveData(); 
        });

        // ç›£è½å…§å®¹è®Šæ›´ä»¥è§¸ç™¼è‡ªå‹•å„²å­˜
        const inputs = [contentArea, elYear, elMonth, elDay, elWeekday];
        inputs.forEach(el => {
            el.addEventListener('input', () => {
                saveData();
            });
        });

        // Modal Functions
        function showModal() { modalOverlay.style.display = 'flex'; }
        function closeModal() { modalOverlay.style.display = 'none'; contentArea.focus(); }

        // æ¸…ç©ºç¢ºèªåŠŸèƒ½
        function openConfirmModal() { confirmModalOverlay.style.display = 'flex'; }
        function closeConfirmModal() { confirmModalOverlay.style.display = 'none'; }
        function performClear() {
            contentArea.innerText = '';
            setDate(); 
            saveData(); 
            closeConfirmModal();
            contentArea.focus();
        }

        contentArea.addEventListener('paste', function(e) {
            e.preventDefault();
            var text = (e.originalEvent || e).clipboardData.getData('text/plain');
            document.execCommand('insertText', false, text);
        });

        // åˆå§‹åŒ–
        loadTheme();
        loadData(); // è¼‰å…¥è³‡æ–™ (å…§éƒ¨æœƒè¨­å®šå­—é«”å¤§å°è®Šæ•¸)
        
        // ç¢ºä¿è¼‰å…¥è³‡æ–™å¾Œï¼Œå°ºæ¨™ä¾æ“šæ­£ç¢ºçš„å­—é«”å¤§å°ç¹ªè£½
        requestAnimationFrame(() => {
            updateRuler();
        });

        // é»æ“ŠèƒŒæ™¯é—œé–‰ Modal
        modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });
        confirmModalOverlay.addEventListener('click', (e) => { if (e.target === confirmModalOverlay) closeConfirmModal(); });

    </script>

    <script src="https://cdn.jsdelivr.net/gh/ButTaiwan/bpmfvs@main/js/bpmflib.js" 
            onload="window.bpmfLoaded=true;" 
            onerror="window.bpmfLoaded=false;"></script>
</body>
</html>