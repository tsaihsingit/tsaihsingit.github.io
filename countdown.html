<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²éšè¨ˆæ™‚å™¨</title>
    <style>
        :root {
            /* æ·ºè‰²æ¨¡å¼è®Šæ•¸ (é è¨­) */
            --bg-color: #f0f2f5;
            --text-color: #333;
            --timer-color: #222;
            --panel-bg: rgba(255, 255, 255, 0.6);
            --btn-bg: #fff;
            --btn-shadow: rgba(0,0,0,0.1);
            --bar-bg: #e0e0e0;
            --bar-fill: #007bff;
            --danger-color: #dc3545;
            --preset-btn-text: #007bff;
            --preset-btn-border: #007bff;
            --preset-btn-hover-bg: #007bff;
            --preset-btn-hover-text: #fff;
        }

        /* æ·±è‰²æ¨¡å¼è®Šæ•¸ */
        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f0f0f0;
            --timer-color: #fff;
            --panel-bg: rgba(50, 50, 50, 0.6);
            --btn-bg: #333;
            --btn-shadow: rgba(0,0,0,0.5);
            --bar-bg: #444;
            --bar-fill: #4dabf7;
            --danger-color: #ff6b6b;
            --preset-btn-text: #4dabf7;
            --preset-btn-border: #4dabf7;
            --preset-btn-hover-bg: #4dabf7;
            --preset-btn-hover-text: #1a1a1a;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* å³ä¸Šè§’ç¾åœ¨æ™‚é–“ */
        #current-clock {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2.25rem;
            font-weight: 500;
            color: var(--text-color);
            background: var(--panel-bg);
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px var(--btn-shadow);
            backdrop-filter: blur(5px);
        }

        /* å·¦ä¸Šè§’ä¸»é¡Œåˆ‡æ› */
        #theme-toggle {
            position: absolute;
            top: auto;
            bottom: 20px;
            left: 30px;
            font-size: 1.5rem;
            background: var(--panel-bg);
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px var(--btn-shadow);
            color: var(--text-color);
            transition: transform 0.2s;
        }
        #theme-toggle:active { transform: scale(0.9); }

        /* ä¸»è¦é¡¯ç¤ºå€åŸŸå®¹å™¨ */
        .main-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 95%;
            max-width: 1400px;
        }

        /* å·¦å³æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 25px;
            background: var(--panel-bg);
            border-radius: 20px;
            box-shadow: 0 4px 15px var(--btn-shadow);
            backdrop-filter: blur(5px);
        }

        /* ä¸­é–“å€åŸŸ (æ™‚é–“ + é€²åº¦æ¢) */
        .center-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            min-width: 450px;
        }

        /* è¨ˆæ™‚å™¨å¤§å­—é«” */
        #timer-display {
            font-size: 8rem;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            color: var(--timer-color);
            text-align: center;
            user-select: none;
            line-height: 1;
            margin-bottom: 20px;
            transition: color 0.2s;
        }

        /* é€²åº¦æ¢å®¹å™¨ */
        .progress-container {
            width: 80%;
            height: 12px;
            background-color: var(--bar-bg);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        /* é€²åº¦æ¢æœ¬é«” */
        #progress-bar {
            height: 100%;
            width: 0%; /* åˆå§‹ 0% æˆ– 100% è¦–é‚è¼¯è€Œå®š */
            background-color: var(--bar-fill);
            border-radius: 6px;
            transition: width 0.2s linear; /* å¹³æ»‘éæ¸¡ */
        }

        /* æ§åˆ¶æŒ‰éˆ•æ¨£å¼ (Emoji) */
        .btn-control {
            font-size: 2.5rem;
            padding: 10px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px var(--btn-shadow);
            background-color: var(--btn-bg);
            line-height: 1;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-control:hover { transform: translateY(-2px); box-shadow: 0 6px 12px var(--btn-shadow); filter: brightness(0.95); }
        .btn-control:active { transform: scale(0.95); }

        /* ä¸‹æ–¹è¨­å®šæ™‚é–“æŒ‰éˆ•å€ */
        .preset-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            max-width: 900px;
            width: 90%;
            padding: 20px;
            background: var(--panel-bg);
            border-radius: 15px;
            box-shadow: 0 4px 10px var(--btn-shadow);
            backdrop-filter: blur(5px);
        }

        .btn-add {
            background-color: transparent;
            color: var(--preset-btn-text);
            border: 2px solid var(--preset-btn-border);
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px 24px;
            border-radius: 10px;
            flex: 1 1 auto;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-add:hover {
            background-color: var(--preset-btn-hover-bg);
            color: var(--preset-btn-hover-text);
        }

        .btn-reset {
            background-color: #6c757d;
            color: white;
            border: 2px solid #6c757d;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px 24px;
            border-radius: 10px;
            flex: 1 1 auto;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-reset:hover { background-color: #5a6268; border-color: #5a6268; }

        /* RWD éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 1024px) {
            #timer-display { font-size: 6rem; }
            .center-display { min-width: 300px; }
            .btn-control { width: 60px; height: 60px; font-size: 2rem; }
        }

        @media (max-width: 768px) {
            .main-container { flex-direction: column; gap: 15px; }
            .control-panel { flex-direction: row; width: 100%; justify-content: center; padding: 15px; }
            .center-display { order: -1; margin: 10px 0; width: 100%; }
            #timer-display { font-size: 5rem; }
        }

        /* --- å‹•ç•«æ•ˆæœ --- */

        /* åƒ…é–ƒçˆæ–‡å­—é¡è‰²çš„å‹•ç•« */
        @keyframes flash-text-only {
            0% { color: var(--danger-color); opacity: 1; }
            50% { color: var(--danger-color); opacity: 0.2; }
            100% { color: var(--danger-color); opacity: 1; }
        }

        .time-up-text {
            animation: flash-text-only 0.5s infinite;
            /* å¼·åˆ¶è¦†è“‹åŸæœ¬é¡è‰² */
            color: var(--danger-color) !important; 
        }

    </style>
</head>
<body>

    <!-- å·¦ä¸Šè§’ä¸»é¡Œåˆ‡æ› -->
    <button id="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ›æ·±è‰²/æ·ºè‰²æ¨¡å¼">ğŸŒ—</button>

    <!-- å³ä¸Šè§’ç¾åœ¨æ™‚é–“ -->
    <div id="current-clock">Loading...</div>

    <!-- ä¸»è¦å€åŸŸ -->
    <div class="main-container">
        
        <!-- å·¦å´æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <button class="btn-control" onclick="startTimer()" title="é–‹å§‹">â–¶ï¸</button>
            <button class="btn-control" onclick="pauseTimer()" title="æš«åœ">â¸ï¸</button>
            <button class="btn-control" onclick="stopTimer()" title="åœæ­¢/å¾©åŸ">â¹ï¸</button>
        </div>

        <!-- ä¸­é–“æ™‚é–“èˆ‡é€²åº¦æ¢ -->
        <div class="center-display">
            <div id="timer-display">00:00:00</div>
            <div class="progress-container">
                <div id="progress-bar"></div>
            </div>
        </div>

        <!-- å³å´æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <button class="btn-control" onclick="startTimer()" title="é–‹å§‹">â–¶ï¸</button>
            <button class="btn-control" onclick="pauseTimer()" title="æš«åœ">â¸ï¸</button>
            <button class="btn-control" onclick="stopTimer()" title="åœæ­¢/å¾©åŸ">â¹ï¸</button>
        </div>

    </div>

    <!-- ä¸‹æ–¹è¨­å®šæŒ‰éˆ• -->
    <div class="preset-area">
        <button class="btn-add" onclick="addTime(600)">+10m</button>
        <button class="btn-add" onclick="addTime(300)">+5m</button>
        <button class="btn-add" onclick="addTime(60)">+1m</button>
        <button class="btn-add" onclick="addTime(30)">+30s</button>
        <button class="btn-add" onclick="addTime(10)">+10s</button>
        <button class="btn-reset" onclick="resetTimer()">æ­¸é›¶</button>
    </div>

    <script>
        // è®Šæ•¸è¨­å®š
        let totalSeconds = 0;       // ç›®å‰å‰©é¤˜ç§’æ•¸
        let originalSeconds = 0;    // ç´€éŒ„åŸæœ¬è¨­å®šçš„ç¸½ç§’æ•¸ (ç”¨æ–¼é€²åº¦æ¢èˆ‡åœæ­¢å¾©åŸ)
        let timerInterval = null;
        let audioCtx = null; 

        const display = document.getElementById('timer-display');
        const progressBar = document.getElementById('progress-bar');
        const clockElement = document.getElementById('current-clock');
        const body = document.body;

        // --- 0. ä¸»é¡Œåˆ‡æ› ---
        function toggleTheme() {
            body.classList.toggle('dark-mode');
        }

        // --- 1. å³ä¸Šè§’æ™‚é˜åŠŸèƒ½ ---
        function updateCurrentTime() {
            const now = new Date();
            clockElement.innerText = now.toLocaleTimeString('zh-TW', { hour12: false });
        }
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        // --- 2. æ ¼å¼åŒ–æ™‚é–“ hh:mm:ss ---
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function updateDisplay() {
            display.innerText = formatTime(totalSeconds);
            updateProgressBar();
        }

        // --- 3. é€²åº¦æ¢é‚è¼¯ ---
        function updateProgressBar() {
            if (originalSeconds <= 0) {
                progressBar.style.width = '0%';
                return;
            }
            // è¨ˆç®—å‰©é¤˜ç™¾åˆ†æ¯”
            const percentage = (totalSeconds / originalSeconds) * 100;
            progressBar.style.width = `${Math.max(0, percentage)}%`;
        }

        // --- 4. æŒ‰éˆ•é‚è¼¯ ---
        function addTime(seconds) {
            stopAlarm();
            
            // ç´¯åŠ æ™‚é–“
            totalSeconds += seconds;
            // åŒæ™‚æ›´æ–°åŸå§‹è¨­å®šæ™‚é–“ï¼Œé€™æ¨£é€²åº¦æ¢åˆ†æ¯æ‰æœƒæ­£ç¢º
            originalSeconds += seconds;
            
            updateDisplay();
        }

        function resetTimer() {
            stopAlarm();
            pauseTimer();
            totalSeconds = 0;
            originalSeconds = 0;
            updateDisplay();
        }

        function startTimer() {
            initAudio(); 
            stopAlarm(); 

            if (timerInterval) return; 
            if (totalSeconds <= 0) return;

            // å¦‚æœ originalSeconds å› ç‚ºæŸäº›åŸå› è·‘æ‰ï¼ˆä¾‹å¦‚æ‰‹å‹•æ­¸é›¶å¾Œç›´æ¥é–‹å§‹ï¼‰ï¼Œé‡è¨­å®ƒ
            if (originalSeconds === 0) originalSeconds = totalSeconds;

            timerInterval = setInterval(() => {
                if (totalSeconds > 0) {
                    totalSeconds--;
                    updateDisplay();
                } else {
                    timeUp();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            stopAlarm(); 
        }

        function stopTimer() {
            // åœæ­¢è¨ˆæ™‚
            pauseTimer();
            stopAlarm();

            // æ¢å¾©åˆ°åŸæœ¬è¨­å®šçš„æ™‚é–“
            if (originalSeconds > 0) {
                totalSeconds = originalSeconds;
                updateDisplay();
            }
        }

        // --- 5. é¬§éˆ´èˆ‡æ–‡å­—é–ƒçˆ ---
        function timeUp() {
            clearInterval(timerInterval);
            timerInterval = null;
            
            // é€²åº¦æ¢æ­¸é›¶
            totalSeconds = 0;
            updateDisplay();

            playBeep();
            
            // åªå°æ–‡å­—åŠ  class
            display.classList.add('time-up-text');
        }

        function stopAlarm() {
            display.classList.remove('time-up-text');
        }

        // --- 6. éŸ³æ•ˆåˆæˆ (Web Audio API) ---
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playBeep() {
            if (!audioCtx) initAudio();
            
            let beepCount = 0;
            const maxFlashes = 10; // è¨­å®šé–ƒçˆä¸Šé™ç‚º 10 æ¬¡

            const beepInterval = setInterval(() => {
                // æª¢æŸ¥æ˜¯å¦é‚„åœ¨é–ƒçˆæ–‡å­—ï¼Œå¦‚æœä¸é–ƒäº†å°±åœæ­¢è²éŸ³
                if (!display.classList.contains('time-up-text')) {
                    clearInterval(beepInterval);
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦é”åˆ°æ¬¡æ•¸é™åˆ¶
                if (beepCount >= maxFlashes) {
                    clearInterval(beepInterval);
                    stopAlarm(); // æ™‚é–“åˆ°è‡ªå‹•åœæ­¢
                    
                    // é–ƒçˆå®Œç•¢å¾Œï¼Œè‡ªå‹•å›åˆ°è¨­å®šçš„æ™‚é–“
                    if (originalSeconds > 0) {
                        totalSeconds = originalSeconds;
                        updateDisplay();
                    }
                    
                    return;
                }

                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.type = 'square';
                osc.frequency.value = 880; 
                
                const now = audioCtx.currentTime;
                gain.gain.setValueAtTime(0.3, now);
                
                osc.start(now);
                osc.stop(now + 0.2); 
                
                beepCount++;
            }, 500); 
        }
    </script>
</body>
</html>